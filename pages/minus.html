<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minus - Sjov Matematik</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="container">
    <header class="header">
      <h1><i class="fas fa-minus"></i> Minus (Subtraktion)</h1>
      <p>Lær at trække tal fra hinanden. Pas på - det kan blive tricky!</p>
    </header>

    <div class="stats-bar">
      <div class="stat-item">
        <div class="stat-label">Niveau</div>
        <div class="stat-value" id="userLevel">1</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Point</div>
        <div class="stat-value" id="userPoints">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">I træk</div>
        <div class="stat-value" id="streak">0</div>
      </div>
    </div>

    <main>
      <!-- NIVEAU VÆLGER -->
      <div style="margin-bottom: 30px; text-align: center;">
        <h3>Vælg sværhedsgrad:</h3>
        <div class="level-buttons">
          <button class="level-btn active" data-level="1">Let (positive resultater)</button>
          <button class="level-btn" data-level="2">Mellem (mellemstore tal)</button>
          <button class="level-btn" data-level="3">Svær (negative tal muligt)</button>
        </div>
      </div>

      <!-- OPGAVE -->
      <div class="opgave-container">
        <div class="opgave-tekst" id="opgaveTekst">
          <!-- Opgaven vises her -->
        </div>
        
        <div class="input-group">
          <input type="number" id="svarInput" class="answer-input" placeholder="Dit svar" autofocus>
          <button onclick="tjekSvar()" class="button primary-btn" style="background: #f56565;">
            <i class="fas fa-check"></i> Tjek svar
          </button>
          <button onclick="nyOpgave()" class="button secondary-btn">
            <i class="fas fa-redo"></i> Ny opgave
          </button>
        </div>
        
        <div style="margin-top: 20px;">
          <button onclick="visHjaelp()" class="button" style="background: #f6ad55; color: white;">
            <i class="fas fa-question-circle"></i> Få hjælp
          </button>
          <button onclick="visForklaring()" class="button" style="background: #90cdf4; color: white;">
            <i class="fas fa-lightbulb"></i> Se løsning
          </button>
        </div>
      </div>
      
      <!-- FEEDBACK -->
      <div id="feedback" class="feedback"></div>
      
      <!-- TILBAGE -->
      <div style="text-align: center; margin-top: 40px;">
        <a href="../index.html" class="back-link">
          <i class="fas fa-arrow-left"></i> Tilbage til menuen
        </a>
      </div>
    </main>
  </div>

  <!-- JAVASCRIPT -->
  <script src="../js/app.js"></script>
  <script>
    // MINUS SPECIFIK KODE
    let currentLevel = 1;
    let currentTal1, currentTal2, correctAnswer;
    let streak = 0;

    // NÅR SIDEN INDLÆSES
    document.addEventListener('DOMContentLoaded', function() {
      loadUserData();
      opdaterBrugerinfo();
      setupLevelButtons();
      genererOpgave();
      
      // Enter-tasten
      document.getElementById('svarInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') tjekSvar();
      });
    });

    // OPDATER BRUGERINFO
    function opdaterBrugerinfo() {
      document.getElementById('userLevel').textContent = currentLevel;
      document.getElementById('userPoints').textContent = userData.totalPoints;
      document.getElementById('streak').textContent = streak;
    }

    // SETUP NIVEAU KNAPPER
    function setupLevelButtons() {
      const buttons = document.querySelectorAll('.level-btn');
      buttons.forEach(btn => {
        btn.addEventListener('click', function() {
          buttons.forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          currentLevel = parseInt(this.dataset.level);
          opdaterBrugerinfo();
          genererOpgave();
        });
      });
    }

    // GENERER NY MINUS OPGAVE
    function genererOpgave() {
      let maxTal;
      let allowNegative = currentLevel === 3;
      
      switch(currentLevel) {
        case 1: maxTal = 20; break;
        case 2: maxTal = 50; break;
        case 3: maxTal = 100; break;
        default: maxTal = 20;
      }
      
      currentTal1 = Math.floor(Math.random() * maxTal) + 1;
      currentTal2 = Math.floor(Math.random() * maxTal) + 1;
      
      // Sørg for positivt resultat på niveau 1-2
      if (!allowNegative && currentTal2 > currentTal1) {
        // Byt om så største tal er først
        [currentTal1, currentTal2] = [currentTal2, currentTal1];
      }
      
      correctAnswer = currentTal1 - currentTal2;
      
      // Vis opgaven
      document.getElementById('opgaveTekst').innerHTML = `
        Hvad er <span class="regnearter">${currentTal1}</span> 
        <i class="fas fa-minus" style="color: #f56565;"></i> 
        <span class="regnearter">${currentTal2}</span> 
        ?
      `;
      
      // Nulstil input
      document.getElementById('svarInput').value = '';
      document.getElementById('svarInput').focus();
    }

    // TJEK SVAR
    function tjekSvar() {
      const svarInput = document.getElementById('svarInput');
      const brugerSvar = parseInt(svarInput.value);
      
      if (isNaN(brugerSvar)) {
        showFeedback('Skriv venligst et tal før du tjekker svar', false);
        return;
      }
      
      const isCorrect = brugerSvar === correctAnswer;
      
      if (isCorrect) {
        streak++;
        showFeedback(`✅ Perfekt! ${currentTal1} - ${currentTal2} = ${correctAnswer}`, true);
        calculateNewLevel(true);
        
        setTimeout(() => {
          genererOpgave();
          opdaterBrugerinfo();
        }, 1500);
      } else {
        streak = 0;
        showFeedback(`❌ ${brugerSvar} er ikke rigtigt. Prøv igen!`, false);
        calculateNewLevel(false);
      }
      
      opdaterBrugerinfo();
    }

    // NY OPGAVE
    function nyOpgave() {
      genererOpgave();
      document.getElementById('feedback').textContent = '';
      document.getElementById('feedback').className = 'feedback';
    }

    // VIS HJÆLP
    function visHjaelp() {
      let hjaelpTekst;
      
      if (correctAnswer >= 0) {
        hjaelpTekst = `
          <strong>Tips til minus:</strong><br>
          1. Start med ${currentTal1}<br>
          2. Tæl ${currentTal2} tilbage<br>
          3. Du ender på ${correctAnswer}<br><br>
          <em>Prøv: ${currentTal1} - ${currentTal2} = ?</em>
        `;
      } else {
        hjaelpTekst = `
          <strong>Tips til negative tal:</strong><br>
          1. ${currentTal1} - ${currentTal2}<br>
          2. Det er som at gå ${currentTal2} skridt baglæns fra ${currentTal1}<br>
          3. Du kommer til ${correctAnswer}<br><br>
          <em>Husk: Når du trækker et større tal fra et mindre, får du et negativt tal</em>
        `;
      }
      
      document.getElementById('feedback').innerHTML = hjaelpTekst;
      document.getElementById('feedback').className = 'feedback hjelp';
    }

    // VIS FORKLARING
    function visForklaring() {
      const forklaring = `
        <strong>Løsningsmetode:</strong><br>
        1. ${currentTal1} - ${currentTal2}<br>
        2. Resultat: ${correctAnswer}<br><br>
        <em>Tænk på en tallinje:<br>
        Start på ${currentTal1}, gå ${currentTal2} skridt til venstre</em>
      `;
      
      document.getElementById('feedback').innerHTML = forklaring;
      document.getElementById('feedback').className = 'feedback hjelp';
    }
  </script>
</body>
</html>